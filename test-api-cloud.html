<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIåŠŸèƒ½æµ‹è¯• - äº‘æœåŠ¡å™¨ç‰ˆæœ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .api-key-preview {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ APIåŠŸèƒ½æµ‹è¯• - äº‘æœåŠ¡å™¨ç‰ˆæœ¬</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•äº‘æœåŠ¡å™¨ç‰ˆæœ¬çš„APIåŠŸèƒ½ï¼Œç¡®ä¿å…¶ä»–äººè®¿é—®æ—¶APIæ­£å¸¸å·¥ä½œã€‚</p>
        <p><strong>æµ‹è¯•æ—¶é—´:</strong> <span id="testTime"></span></p>
    </div>

    <div class="test-section">
        <h2>ğŸ”‘ APIå¯†é’¥çŠ¶æ€</h2>
        <div id="apiKeyStatus" class="status info">æ­£åœ¨æ£€æŸ¥APIå¯†é’¥çŠ¶æ€...</div>
        <div id="apiKeyPreview" class="api-key-preview"></div>
        <button onclick="testApiKey()">æµ‹è¯•APIå¯†é’¥</button>
        <button onclick="resetToDefault()">é‡ç½®ä¸ºé»˜è®¤</button>
    </div>

    <div class="test-section">
        <h2>ğŸŒ APIè¿æ¥æµ‹è¯•</h2>
        <div id="connectionStatus" class="status info">æ­£åœ¨æµ‹è¯•APIè¿æ¥...</div>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š APIä½¿ç”¨ç»Ÿè®¡</h2>
        <div id="usageStats" class="status info">æ­£åœ¨è·å–ä½¿ç”¨ç»Ÿè®¡...</div>
        <button onclick="updateStats()">æ›´æ–°ç»Ÿè®¡</button>
    </div>

    <div class="test-section">
        <h2>ğŸ” YouTube APIæµ‹è¯•</h2>
        <div id="youtubeTest" class="status info">å‡†å¤‡æµ‹è¯•YouTube API...</div>
        <button onclick="testYouTubeApi()">æµ‹è¯•YouTube API</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•ç»“æœ</h2>
        <div id="testResults"></div>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <!-- å¼•å…¥äº‘æœåŠ¡å™¨ç‰ˆæœ¬çš„APIå¯†é’¥ç®¡ç†å™¨ -->
    <script src="assets/js/api-key-manager-cloud.js"></script>
    
    <script>
        // è®¾ç½®æµ‹è¯•æ—¶é—´
        document.getElementById('testTime').textContent = new Date().toLocaleString();

        // æµ‹è¯•APIå¯†é’¥çŠ¶æ€
        function testApiKey() {
            const status = window.apiKeyManager.getApiKeyStatus();
            const statusDiv = document.getElementById('apiKeyStatus');
            const previewDiv = document.getElementById('apiKeyPreview');
            
            if (status.isValid) {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… APIå¯†é’¥æœ‰æ•ˆ';
                previewDiv.textContent = `å¯†é’¥é¢„è§ˆ: ${status.keyPreview}`;
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ APIå¯†é’¥æ— æ•ˆ';
                previewDiv.textContent = 'æ— æœ‰æ•ˆå¯†é’¥';
            }
        }

        // é‡ç½®ä¸ºé»˜è®¤å¯†é’¥
        function resetToDefault() {
            window.apiKeyManager.resetToDefault();
            testApiKey();
            addResult('ğŸ”„ å·²é‡ç½®ä¸ºé»˜è®¤APIå¯†é’¥');
        }

        // æµ‹è¯•APIè¿æ¥
        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...';
            
            try {
                const status = await window.apiKeyManager.checkApiAvailability();
                if (status.available) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… APIè¿æ¥æ­£å¸¸';
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `âŒ APIè¿æ¥å¤±è´¥: ${status.message}`;
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ è¿æ¥æµ‹è¯•å¼‚å¸¸: ${error.message}`;
            }
        }

        // æ›´æ–°ä½¿ç”¨ç»Ÿè®¡
        function updateStats() {
            const stats = window.apiKeyManager.getApiUsageStats();
            const statsDiv = document.getElementById('usageStats');
            
            statsDiv.className = 'status info';
            statsDiv.innerHTML = `
                <strong>ğŸ“Š APIä½¿ç”¨ç»Ÿè®¡:</strong><br>
                æ€»è¯·æ±‚æ•°: ${stats.totalRequests}<br>
                ä»Šæ—¥è¯·æ±‚: ${stats.dailyRequests}<br>
                é…é¢ä½¿ç”¨: ${stats.quotaUsed}/10000<br>
                æœ€åä½¿ç”¨: ${stats.lastUsed ? new Date(stats.lastUsed).toLocaleString() : 'ä»æœªä½¿ç”¨'}
            `;
        }

        // æµ‹è¯•YouTube API
        async function testYouTubeApi() {
            const testDiv = document.getElementById('youtubeTest');
            testDiv.className = 'status info';
            testDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•YouTube API...';
            
            try {
                const key = window.apiKeyManager.getCurrentApiKey();
                const testUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=test&key=${key}&maxResults=1`;
                
                const response = await fetch(testUrl);
                if (response.ok) {
                    const data = await response.json();
                    testDiv.className = 'status success';
                    testDiv.textContent = 'âœ… YouTube APIæµ‹è¯•æˆåŠŸ';
                    addResult(`âœ… YouTube APIæµ‹è¯•æˆåŠŸï¼Œæ‰¾åˆ° ${data.items.length} ä¸ªç»“æœ`);
                } else {
                    const errorData = await response.json();
                    testDiv.className = 'status error';
                    testDiv.textContent = `âŒ YouTube APIæµ‹è¯•å¤±è´¥: ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`;
                    addResult(`âŒ YouTube APIæµ‹è¯•å¤±è´¥: ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                testDiv.className = 'status error';
                testDiv.textContent = `âŒ YouTube APIæµ‹è¯•å¼‚å¸¸: ${error.message}`;
                addResult(`âŒ YouTube APIæµ‹è¯•å¼‚å¸¸: ${error.message}`);
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            addResult('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            testApiKey();
            await testConnection();
            updateStats();
            await testYouTubeApi();
            
            addResult('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ');
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addResult(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `<div class="status info">[${timestamp}] ${message}</div>`;
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('load', () => {
            testApiKey();
            updateStats();
        });
    </script>
</body>
</html>




